name: Build Thunder on Windows

# CHANGE TO MASTER
on:
  push:
    branches: ["development/update-windows-build"]
  pull_request:
    branches: ["development/update-windows-build"]
  workflow_call:

env:
  bridge: D:\a\Thunder\Thunder\Thunder\Source\WPEFramework\bridge.vcxproj
  comProcess: D:\a\Thunder\Thunder\Thunder\Source\WPEProcess\comprocess.vcxproj
  devEnv: C:\Program Files\Microsoft Visual Studio\2022\Enterprise\Common7\IDE\devenv.com
  solution: D:\a\Thunder\Thunder\Thunder.sln

jobs:
  build:
    runs-on: windows-latest

    strategy:
      matrix:
        build_type: ["Debug|x64", "Debug|x86", "Release|x64", "Release|x86"]

# CHANGE THE BRANCHES
    steps:
    - name: Checkout ThunderOnWindows
      uses: actions/checkout@v3
      with:
        ref: development/update-windows-build
        repository: ${{github.repository_owner}}/ThunderOnWindows

    - name: Checkout Thunder
      uses: actions/checkout@v3
      with:
        path: Thunder
        ref: development/update-windows-build
        repository: ${{github.repository_owner}}/Thunder

    - name: Checkout ThunderClientLibraries
      uses: actions/checkout@v3
      with:
        path: ThunderClientLibraries
        ref: development/update-windows-build
        repository: ${{github.repository_owner}}/ThunderClientLibraries

    - name: Checkout ThunderInterfaces
      uses: actions/checkout@v3
      with:
        path: ThunderInterfaces
        ref: development/update-windows-build
        repository: ${{github.repository_owner}}/ThunderInterfaces

    - name: Checkout ThunderNanoServices
      uses: actions/checkout@v3
      with:
        path: ThunderNanoServices
        ref: development/update-windows-build
        repository: ${{github.repository_owner}}/ThunderNanoServices

# CHANGE REPO OWNER
    - name: Checkout ThunderNanoServicesRDK
      uses: actions/checkout@v3
      with:
        path: ThunderNanoServicesRDK
        ref: development/update-windows-build
        repository: VeithMetro/ThunderNanoServicesRDK

    - name: Install jsonref
      run: pip install jsonref

    - name: Build Thunder
      shell: cmd
      run: |
        "%devEnv%" /Build "${{matrix.build_type}}"  "%solution%"
#     - name: Build Thunder
#       shell: cmd
#       run: |
#         "%devEnv%" /Build "Debug|x64" /Project "%bridge%"  "%solution%"
#         "%devEnv%" /Build "Debug|x64" /Project "%comProcess%"  "%solution%"
